Predicting Activity from sensor Data
========================================================

# Summary
The goal of this exercise was to use sensory data collected from accelerometers on various body parts to determine the way a weight lifting exercise was performed. There were 6 male participants between the ages of 20-28, all with little weight lifting experience. They were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E). We wanted to build a model that could predict the Class for collected data. A random forest model was used yielding very accurate results.

(more on the data collection here: http://groupware.les.inf.puc-rio.br/har#ixzz38KdLkcYg)

# Loading and Cleaning Data

## Data Loading


```r
# load dataset for training
train_data <- read.csv2("pml-training.csv", sep=",", header = TRUE, na.strings = c("","NA"))
# load dataset for testing
test_data <- read.csv2("pml-testing.csv", sep=",", header=TRUE, na.strings=c("","NA"))
```

## Data Cleaning


```r
# Inspect data
str(train_data)
```

```
## 'data.frame':	19622 obs. of  160 variables:
##  $ X                       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ user_name               : Factor w/ 6 levels "adelmo","carlitos",..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ raw_timestamp_part_1    : int  1323084231 1323084231 1323084231 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 ...
##  $ raw_timestamp_part_2    : int  788290 808298 820366 120339 196328 304277 368296 440390 484323 484434 ...
##  $ cvtd_timestamp          : Factor w/ 20 levels "02/12/2011 13:32",..: 9 9 9 9 9 9 9 9 9 9 ...
##  $ new_window              : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
##  $ num_window              : int  11 11 11 12 12 12 12 12 12 12 ...
##  $ roll_belt               : Factor w/ 1330 levels "-0.01","-0.02",..: 771 771 772 778 778 775 772 772 773 775 ...
##  $ pitch_belt              : Factor w/ 1840 levels "-0.01","-0.02",..: 1681 1681 1681 1679 1681 1680 1683 1687 1690 1691 ...
##  $ yaw_belt                : Factor w/ 1957 levels "-0.02","-0.03",..: 1122 1122 1122 1122 1122 1122 1122 1122 1122 1122 ...
##  $ total_accel_belt        : int  3 3 3 3 3 3 3 3 3 3 ...
##  $ kurtosis_roll_belt      : Factor w/ 396 levels "-0.016850","-0.021024",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ kurtosis_picth_belt     : Factor w/ 316 levels "-0.021887","-0.060755",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ kurtosis_yaw_belt       : Factor w/ 1 level "#DIV/0!": NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_roll_belt      : Factor w/ 394 levels "-0.003095","-0.010002",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_roll_belt.1    : Factor w/ 337 levels "-0.005928","-0.005960",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_yaw_belt       : Factor w/ 1 level "#DIV/0!": NA NA NA NA NA NA NA NA NA NA ...
##  $ max_roll_belt           : Factor w/ 195 levels "-0.2","-0.4",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ max_picth_belt          : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_yaw_belt            : Factor w/ 67 levels "-0.1","-0.2",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_roll_belt           : Factor w/ 184 levels "-0.2","-0.5",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_pitch_belt          : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_yaw_belt            : Factor w/ 67 levels "-0.1","-0.2",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_roll_belt     : Factor w/ 148 levels "0","0.1","0.13",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_pitch_belt    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_yaw_belt      : Factor w/ 3 levels "#DIV/0!","0.00",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_total_accel_belt    : Factor w/ 65 levels "0","0.0217","0.0278",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_roll_belt           : Factor w/ 191 levels "-0.2","-0.3",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_roll_belt        : Factor w/ 69 levels "0","0.091","0.0957",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_roll_belt           : Factor w/ 96 levels "0","0.0083","0.0092",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_pitch_belt          : Factor w/ 214 levels "-0.2","-0.4",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_pitch_belt       : Factor w/ 43 levels "0","0.0571","0.1",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_pitch_belt          : Factor w/ 63 levels "0","0.0033","0.0393",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_yaw_belt            : Factor w/ 240 levels "-0.1","-0.7",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_yaw_belt         : Factor w/ 58 levels "0","0.0407","0.0522",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_yaw_belt            : Factor w/ 145 levels "0","0.0017","0.0027",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ gyros_belt_x            : Factor w/ 140 levels "-0.02","-0.03",..: 64 65 64 65 65 65 65 65 65 66 ...
##  $ gyros_belt_y            : Factor w/ 69 levels "-0.02","-0.03",..: 33 33 33 33 34 33 33 33 33 33 ...
##  $ gyros_belt_z            : Factor w/ 169 levels "-0.02","-0.03",..: 1 1 1 2 1 1 1 1 1 80 ...
##  $ accel_belt_x            : int  -21 -22 -20 -22 -21 -21 -22 -22 -20 -21 ...
##  $ accel_belt_y            : int  4 4 5 3 2 4 3 4 2 4 ...
##  $ accel_belt_z            : int  22 22 23 21 24 21 21 21 24 22 ...
##  $ magnet_belt_x           : int  -3 -7 -2 -6 -6 0 -4 -2 1 -3 ...
##  $ magnet_belt_y           : int  599 608 600 604 600 603 599 603 602 609 ...
##  $ magnet_belt_z           : int  -313 -311 -305 -310 -302 -312 -311 -313 -312 -308 ...
##  $ roll_arm                : Factor w/ 2654 levels "-0.02","-0.04",..: 120 120 120 120 120 120 120 120 120 120 ...
##  $ pitch_arm               : Factor w/ 3087 levels "-0.01","-0.02",..: 1882 1882 1882 1878 1878 1877 1876 1875 1874 1873 ...
##  $ yaw_arm                 : Factor w/ 2876 levels "-0.02","-0.05",..: 212 212 212 212 212 212 212 212 212 212 ...
##  $ total_accel_arm         : int  34 34 34 34 34 34 34 34 34 34 ...
##  $ var_accel_arm           : Factor w/ 395 levels "0","0.0179","0.02",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_roll_arm            : Factor w/ 330 levels "-0.7853","-1.9176",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_roll_arm         : Factor w/ 330 levels "0","0.05","0.1081",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_roll_arm            : Factor w/ 330 levels "0","0.0025","0.0117",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_pitch_arm           : Factor w/ 330 levels "-0.3724","-0.4137",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_pitch_arm        : Factor w/ 330 levels "0","0.0153","0.135",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_pitch_arm           : Factor w/ 330 levels "0","0.0182","0.0275",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_yaw_arm             : Factor w/ 330 levels "-0.0188","-0.07",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_yaw_arm          : Factor w/ 327 levels "0","0.3471","0.3594",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ var_yaw_arm             : Factor w/ 327 levels "0","0.1205","0.1292",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ gyros_arm_x             : Factor w/ 643 levels "-0.02","-0.03",..: 356 357 357 357 356 357 356 357 357 357 ...
##  $ gyros_arm_y             : Factor w/ 376 levels "-0.02","-0.03",..: 202 1 1 2 2 2 2 1 2 2 ...
##  $ gyros_arm_z             : Factor w/ 248 levels "-0.02","-0.03",..: 1 1 1 114 113 113 113 113 1 1 ...
##  $ accel_arm_x             : int  -288 -290 -289 -289 -289 -289 -289 -289 -288 -288 ...
##  $ accel_arm_y             : int  109 110 110 111 111 111 111 111 109 110 ...
##  $ accel_arm_z             : int  -123 -125 -126 -123 -123 -122 -125 -124 -122 -124 ...
##  $ magnet_arm_x            : int  -368 -369 -368 -372 -374 -369 -373 -372 -369 -376 ...
##  $ magnet_arm_y            : int  337 337 344 344 337 342 336 338 341 334 ...
##  $ magnet_arm_z            : int  516 513 513 512 506 513 509 510 518 516 ...
##  $ kurtosis_roll_arm       : Factor w/ 329 levels "-0.02438","-0.04190",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ kurtosis_picth_arm      : Factor w/ 327 levels "-0.00484","-0.01311",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ kurtosis_yaw_arm        : Factor w/ 394 levels "-0.01548","-0.01749",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_roll_arm       : Factor w/ 330 levels "-0.00051","-0.00696",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_pitch_arm      : Factor w/ 327 levels "-0.00184","-0.01185",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_yaw_arm        : Factor w/ 394 levels "-0.00311","-0.00562",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ max_roll_arm            : Factor w/ 290 levels "-0.1","-0.2",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ max_picth_arm           : Factor w/ 263 levels "-0.8","-1.8",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ max_yaw_arm             : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_roll_arm            : Factor w/ 278 levels "-0.2","-0.6",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_pitch_arm           : Factor w/ 290 levels "-1","-1.2","-10.4",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_yaw_arm             : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_roll_arm      : Factor w/ 306 levels "0","0.03","0.5",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_pitch_arm     : Factor w/ 294 levels "0","1","10","10.4",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_yaw_arm       : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ roll_dumbbell           : Factor w/ 16523 levels "-0.970112066",..: 6515 6531 6197 6574 6567 6568 6530 6179 6537 6562 ...
##  $ pitch_dumbbell          : Factor w/ 16040 levels "-0.45631348",..: 9693 9701 9671 9684 9689 9717 9669 9680 9688 9720 ...
##  $ yaw_dumbbell            : Factor w/ 16381 levels "-0.585821306",..: 6625 6577 6688 6624 6615 6520 6674 6673 6636 6515 ...
##  $ kurtosis_roll_dumbbell  : Factor w/ 397 levels "-0.0035","-0.0073",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ kurtosis_picth_dumbbell : Factor w/ 400 levels "-0.0163","-0.0233",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ kurtosis_yaw_dumbbell   : Factor w/ 1 level "#DIV/0!": NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_roll_dumbbell  : Factor w/ 400 levels "-0.0082","-0.0096",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_pitch_dumbbell : Factor w/ 401 levels "-0.0053","-0.0084",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ skewness_yaw_dumbbell   : Factor w/ 1 level "#DIV/0!": NA NA NA NA NA NA NA NA NA NA ...
##  $ max_roll_dumbbell       : Factor w/ 338 levels "-10.1","-11.1",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ max_picth_dumbbell      : Factor w/ 339 levels "-100.1","-100.3",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ max_yaw_dumbbell        : Factor w/ 72 levels "-0.1","-0.2",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_roll_dumbbell       : Factor w/ 332 levels "-1","-1.2","-10.1",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_pitch_dumbbell      : Factor w/ 356 levels "-1.5","-10.5",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ min_yaw_dumbbell        : Factor w/ 72 levels "-0.1","-0.2",..: NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_roll_dumbbell : Factor w/ 387 levels "0","0.96","1",..: NA NA NA NA NA NA NA NA NA NA ...
##   [list output truncated]
```

```r
# remove columns with more than 90% NAs and the first 7 columns which do not contain sensory data
train_data <- train_data[,colSums(!is.na(train_data)) > 0.90*nrow(train_data)]
train_data <- subset(train_data, select=-c(1:7))
test_data <- test_data[,colSums(!is.na(test_data)) > 0.90*nrow(test_data)]
test_data <- subset(test_data, select=-c(1:7))

# turn factor variables into numeric data
for ( i in 1:52) {
        train_data[,i] <- as.numeric(as.character(train_data[,i]))
        test_data[,i] <- as.numeric(as.character(test_data[,i]))
        }
```

Split Training Data to Training and Cross-Validation to be used to determine the error estimate on the actual test data


```r
# split training data-set into cross-validation and actual training
library(caret)
set.seed(1234)
toTrain <- createDataPartition(train_data$classe, p = 0.60, list = FALSE)
training <- train_data[toTrain,]
validation <- train_data[-toTrain,]
```

# Creating model using "caret" and "randomForest" packages

Since not too much was known about the features in the dataset and accuracy was a main concern, it seemed appropriate to use a random forest method to create a predictive model. A random forest will create a multitude of separate decision trees and the predictions will be made using the mode of the classes of the individual trees.


```r
library(randomForest)
library(caret)

fit <- train(classe~. , method="rf", data=training)
# predict on the cross-validation dataset
predictions <- predict(fit$finalModel, validation[,c(1:52)])
percentage_correct <- sum(predictions == validation[,53])/nrow(validation)
```

# check correctness per class

```r
As <- sum((predictions =="A") & (validation$classe == "A")) / sum(validation$classe == "A")
Bs <- sum((predictions =="B") & (validation$classe == "B")) / sum(validation$classe == "B")
Cs <- sum((predictions =="C") & (validation$classe == "C")) / sum(validation$classe == "C")
Ds <- sum((predictions =="D") & (validation$classe == "D")) / sum(validation$classe == "D")
Es <- sum((predictions =="E") & (validation$classe == "E")) / sum(validation$classe == "E")

percentages <- c(As,Bs,Cs,Ds,Es)
accuracy_table <- data.frame(percentages, classe=c("A","B","C","D","E"))
names(accuracy_table) <- c("Correct_Percentage","Classe")
accuracy_table
```

```
##   Correct_Percentage Classe
## 1             1.0000      A
## 2             0.9895      B
## 3             0.9868      C
## 4             0.9767      D
## 5             0.9958      E
```

We can see from the table that the accuracy is not restricted on one classe case but the fitted model gives a good accuracy in all 5 classes.

# Expected out of sample Error Rate
Based on the cross-validation check, the expected out of sample Error Rate would be less than 2%. Since the out of sample error rate is typically higher than in the training set we can expect about 1 or 2 false predictions (5-10%) out of the 20 examples in the test set.

# Actual Test Set Error Rate

The actual Test Set Error Rate was 0%!


